<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Save â€” Minimalist Video Downloader</title>
  <meta name="description" content="Save videos from anywhere. No ads. No tracking. Just speed.">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Syne:wght@400;700;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">

  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’¾</text></svg>">
</head>

<body>
  <main class="app">
    <section class="hero">
      <h1>save</h1>
      <p class="hero__subtitle">Paste a link. Get the video.</p>
    </section>

    <section class="search">
      <div class="search__wrapper">
        <form class="search__form" id="searchForm">
          <input type="url" class="search__input" id="urlInput" placeholder="https://..." required autocomplete="off"
            spellcheck="false">
          <button type="submit" class="search__button" id="searchBtn">Get</button>
        </form>
      </div>
    </section>

    <!-- Loading State -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Fetching video info...</p>
    </div>

    <!-- Error State -->
    <div class="error" id="error" style="display: none;">
      <p class="error__msg" id="errorMsg"></p>
    </div>

    <!-- Result Card -->
    <section class="result" id="result">
      <article class="card">
        <div class="card__media">
          <img src="" alt="" class="card__img" id="thumb">
        </div>
        <div class="card__body">
          <h2 class="card__title" id="title">User Video</h2>
          <div class="card__meta">
            <span id="duration">0:00</span>
            <span id="source">Unknown</span>
          </div>
          <div class="btn-group">
            <a href="#" class="btn btn--primary" id="downloadBtn" download>
              Download MP4
            </a>
            <button class="btn btn--secondary" id="copyBtn">
              Copy Link
            </button>
          </div>
        </div>
      </article>
    </section>
  </main>

  <footer>
    <p>Minimalist. Stateless. Open Source.</p>
  </footer>

  <script>
    const $ = (id) => document.getElementById(id);
    const form = $('searchForm');
    const input = $('urlInput');
    const btn = $('searchBtn');

    // State management
    const setState = (state) => {
      ['loading', 'error', 'result'].forEach(id => $(id).classList.remove('is-visible'));
      if (state) $(state).classList.add('is-visible');
      btn.disabled = state === 'loading';
      btn.textContent = state === 'loading' ? '...' : 'Get';
    };

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const url = input.value.trim();
      if (!url) return;

      setState('loading');

      try {
        // Step 1: Get Info
        const res = await fetch('/api/grabh', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url })
        });

        const data = await res.json();
        if (!data.success) throw new Error(data.error);

        const info = data.data;

        // Populate UI
        $('thumb').src = info.thumbnail;
        $('title').textContent = info.title;
        $('duration').textContent = info.duration_string;
        $('source').textContent = info.extractor.toUpperCase();

        // Setup Download Button
        const safeTitle = info.title.replace(/[^a-z0-9]/gi, '_').toLowerCase();
        const dlUrl = `/api/download?url=${encodeURIComponent(url)}`;

        const dlBtn = $('downloadBtn');
        dlBtn.href = dlUrl;
        dlBtn.setAttribute('download', `${safeTitle}.mp4`);

        // Handle Direct Download Click to avoid navigation
        dlBtn.onclick = (e) => {
          // Optional: You could allow default behavior or handle blob download here
          // implementing a simple direct download for now
        };

        setState('result');
      } catch (err) {
        $('errorMsg').textContent = err.message || 'Failed to fetch video.';
        setState('error');
      }
    });

    $('copyBtn').addEventListener('click', () => {
      navigator.clipboard.writeText(input.value);
      const original = $('copyBtn').textContent;
      $('copyBtn').textContent = 'Copied!';
      setTimeout(() => $('copyBtn').textContent = original, 2000);
    });
  </script>
</body>

</html>